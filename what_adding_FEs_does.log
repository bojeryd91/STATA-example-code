------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Jesper\Research\STATA-example-code\what_adding_FEs_does.log
  log type:  text
 opened on:  11 Nov 2022, 15:31:00

. *** Simulate data
. clear

. set obs 100
number of observations (_N) was 0, now 100

. gen group_ID    = _n

. gen treat_dummy = _n > _N/2

. 
. *       Add a group FE
. scalar sd_group_FEs = 1.0

. gen group_FE = sd_group_FEs*rnormal()

. 
. expand 2
(100 observations created)

. bysort group_ID: gen post = _n

. 
. expand 3
(400 observations created)

. bysort group_ID (post): gen t = _n

. 
. scalar sd_eps = 0.0001

. gen error = sd_eps*rnormal()

. 
. bysort t: gen tmp = rnormal() if _n == 1
(594 missing values generated)

. by     t: gegen time_FEs = max(tmp)

. drop tmp

. 
. gen treatment_effect  = 1

. gen treatXpost_effect = 2

. gen post_dummy = t > 3

. gen treatXpost_dummy = treat_dummy*post_dummy

. gen outcome = treatXpost_effect*treatXpost_dummy + ///
>                                         treatment_effect*treat_dummy + time_FEs + group_FE + error

. 
. *** Summarize the data
. tabstat outcome time_FEs, by(t) stat(mean)

Summary statistics: mean
  by categories of: t 

       t |   outcome  time_FEs
---------+--------------------
       1 |  .9427374  .5010024
       2 |  .7868906  .3451513
       3 |  1.667476  1.225747
       4 |  .9049403 -.5367867
       5 |  2.541039  1.099299
       6 |  1.274779 -.1669723
---------+--------------------
   Total |  1.352977  .4112401
------------------------------

. tabstat outcome time_FEs if treat_dummy == 0, by(t) stat(mean)

Summary statistics: mean
  by categories of: t 

       t |   outcome  time_FEs
---------+--------------------
       1 |   .223656  .5010024
       2 |  .0678032  .3451513
       3 |  .9483842  1.225747
       4 | -.8141526 -.5367867
       5 |  .8219471  1.099299
       6 | -.4443307 -.1669723
---------+--------------------
   Total |  .1338845  .4112401
------------------------------

. tabstat outcome time_FEs treatment_effect treatXpost_effect ///
>                 if treat_dummy == 1, by(t) stat(mean)

Summary statistics: mean
  by categories of: t 

       t |   outcome  time_FEs  treatm~t  treatX~t
---------+----------------------------------------
       1 |  1.661819  .5010024         1         2
       2 |  1.505978  .3451513         1         2
       3 |  2.386567  1.225747         1         2
       4 |  2.624033 -.5367867         1         2
       5 |  4.260131  1.099299         1         2
       6 |  2.993888 -.1669723         1         2
---------+----------------------------------------
   Total |  2.572069  .4112401         1         2
--------------------------------------------------

.                                         
. *** Analysis part. First, run regression with the correct specification
. reg outcome treatXpost_dummy treat_dummy i.t

      Source |       SS           df       MS      Number of obs   =       600
-------------+----------------------------------   F(7, 592)       =    161.43
       Model |  1262.31551         7  180.330787   Prob > F        =    0.0000
    Residual |  661.302968       592  1.11706583   R-squared       =    0.6562
-------------+----------------------------------   Adj R-squared   =    0.6522
       Total |  1923.61848       599   3.2113831   Root MSE        =    1.0569

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000023   .1725932    11.59   0.000     1.661053    2.338992
     treat_dummy |   1.438173   .1220418    11.78   0.000     1.198486    1.677861
                 |
               t |
              2  |  -.1558468   .1494701    -1.04   0.298     -.449403    .1377094
              3  |   .7247381   .1494701     4.85   0.000     .4311819    1.018294
              4  |  -1.037809   .1725932    -6.01   0.000    -1.376778    -.698839
              5  |   .5982902   .1725932     3.47   0.001     .2593207    .9372597
              6  |  -.6679701   .1725932    -3.87   0.000     -1.00694   -.3290006
                 |
           _cons |   .2236507   .1220418     1.83   0.067    -.0160369    .4633384
----------------------------------------------------------------------------------

. 
. **  Note also how the time FEs aren't correctly estimated. Each dummy is
. *               off by the amount of the intercept. _cons in turn is equal to the
. *               omitted dummy for period t = 1. The omission is due to collinearity
. *               and the intercept is taken out of each non-omitted dummy.
. tabstat time_FEs, by(t)

Summary for variables: time_FEs
     by categories of: t 

       t |      mean
---------+----------
       1 |  .5010024
       2 |  .3451513
       3 |  1.225747
       4 | -.5367867
       5 |  1.099299
       6 | -.1669723
---------+----------
   Total |  .4112401
--------------------

. 
. *** Then, compare std. err. of treatXpost_dummy if we don't include time
. *               fixed effects but instead a post dummy
. reg outcome treatXpost_dummy treat_dummy post_dummy

      Source |       SS           df       MS      Number of obs   =       600
-------------+----------------------------------   F(3, 596)       =    249.51
       Model |  1070.91624         3  356.972079   Prob > F        =    0.0000
    Residual |  852.702241       596  1.43070846   R-squared       =    0.5567
-------------+----------------------------------   Adj R-squared   =    0.5545
       Total |  1923.61848       599   3.2113831   Root MSE        =    1.1961

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000023   .1953259    10.24   0.000     1.616412    2.383634
     treat_dummy |   1.438173   .1381163    10.41   0.000      1.16692    1.709427
      post_dummy |  -.5587932   .1381163    -4.05   0.000    -.8300471   -.2875394
           _cons |   .4132812    .097663     4.23   0.000     .2214757    .6050866
----------------------------------------------------------------------------------

. 
. 
. *** Case of no time_FEs but a post effect
. gen post_effect = -0.5*post_dummy 

. replace outcome = outcome - time_FEs + post_effect
(600 real changes made)

. reg outcome treatXpost_dummy treat_dummy post_dummy

      Source |       SS           df       MS      Number of obs   =       600
-------------+----------------------------------   F(3, 596)       =    324.21
       Model |  1079.21596         3  359.738654   Prob > F        =    0.0000
    Residual |  661.302964       596  1.10956873   R-squared       =    0.6201
-------------+----------------------------------   Adj R-squared   =    0.6181
       Total |  1740.51893       599  2.90570773   Root MSE        =    1.0534

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000023   .1720131    11.63   0.000     1.662197    2.337848
     treat_dummy |   1.438173   .1216316    11.82   0.000     1.199295    1.677052
      post_dummy |  -.5000063   .1216316    -4.11   0.000     -.738885   -.2611276
           _cons |  -.2773524   .0860065    -3.22   0.001    -.4462651   -.1084396
----------------------------------------------------------------------------------

. *   Then the std. err. of treatXpost_dummy is small as in the correctly
. *               specified case
. 
. *** Compare with case of including group FEs or not (test small sd_group_FEs
. *       to see the difference in std. err. of treatXpost_dummy)
. reg  outcome treatXpost_dummy treat_dummy post_dummy

      Source |       SS           df       MS      Number of obs   =       600
-------------+----------------------------------   F(3, 596)       =    324.21
       Model |  1079.21596         3  359.738654   Prob > F        =    0.0000
    Residual |  661.302964       596  1.10956873   R-squared       =    0.6201
-------------+----------------------------------   Adj R-squared   =    0.6181
       Total |  1740.51893       599  2.90570773   Root MSE        =    1.0534

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000023   .1720131    11.63   0.000     1.662197    2.337848
     treat_dummy |   1.438173   .1216316    11.82   0.000     1.199295    1.677052
      post_dummy |  -.5000063   .1216316    -4.11   0.000     -.738885   -.2611276
           _cons |  -.2773524   .0860065    -3.22   0.001    -.4462651   -.1084396
----------------------------------------------------------------------------------

. areg outcome treatXpost_dummy             post_dummy, absorb(group_ID)

Linear regression, absorbing indicators         Number of obs     =        600
Absorbed variable: group_ID                     No. of categories =        100
                                                F(   2,    498)   =   1.07e+10
                                                Prob > F          =     0.0000
                                                R-squared         =     1.0000
                                                Adj R-squared     =     1.0000
                                                Root MSE          =     0.0001

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000023   .0000153  1.3e+05   0.000     1.999993    2.000053
      post_dummy |  -.5000063   .0000108 -4.6e+04   0.000    -.5000276   -.4999851
           _cons |   .4417343   5.41e-06  8.2e+04   0.000     .4417237     .441745
----------------------------------------------------------------------------------
F test of absorbed indicators: F(99, 498) =  9.4e+08          Prob > F = 0.000

. log close
      name:  <unnamed>
       log:  C:\Users\Jesper\Research\STATA-example-code\what_adding_FEs_does.log
  log type:  text
 closed on:  11 Nov 2022, 15:31:00
------------------------------------------------------------------------------------------------------
