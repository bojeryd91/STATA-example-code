------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\Jesper\Research\STATA-example-code\what_adding_FEs_does.log
  log type:  text
 opened on:  11 Nov 2022, 15:33:02

. *** Simulate data
. clear

. set obs 100
number of observations (_N) was 0, now 100

. gen group_ID    = _n

. gen treat_dummy = _n > _N/2

. 
. *       Add a group FE
. scalar sd_group_FEs = 1.0

. gen group_FE = sd_group_FEs*rnormal()

. 
. expand 2
(100 observations created)

. bysort group_ID: gen post = _n

. 
. expand 3
(400 observations created)

. bysort group_ID (post): gen t = _n

. 
. scalar sd_eps = 0.001

. gen error = sd_eps*rnormal()

. 
. bysort t: gen tmp = rnormal() if _n == 1
(594 missing values generated)

. by     t: gegen time_FEs = max(tmp)

. drop tmp

. 
. gen treatment_effect  = 1

. gen treatXpost_effect = 2

. gen post_dummy = t > 3

. gen treatXpost_dummy = treat_dummy*post_dummy

. gen outcome = treatXpost_effect*treatXpost_dummy + ///
>                                         treatment_effect*treat_dummy + time_FEs + group_FE + error

. 
. *** Summarize the data
. tabstat outcome time_FEs, by(t) stat(mean)

Summary statistics: mean
  by categories of: t 

       t |   outcome  time_FEs
---------+--------------------
       1 | -.0091445 -.2601991
       2 |  -.200308 -.4511884
       3 | -.6810354 -.9319424
       4 |  .5718021 -.6791729
       5 |  .6114808  -.639457
       6 | -.4146917 -1.665354
---------+--------------------
   Total | -.0203161 -.7712189
------------------------------

. tabstat outcome time_FEs if treat_dummy == 0, by(t) stat(mean)

Summary statistics: mean
  by categories of: t 

       t |   outcome  time_FEs
---------+--------------------
       1 | -.5699558 -.2601991
       2 | -.7610493 -.4511884
       3 | -1.242103 -.9319424
       4 | -.9891319 -.6791729
       5 | -.9495179  -.639457
       6 |  -1.97553 -1.665354
---------+--------------------
   Total | -1.081215 -.7712189
------------------------------

. tabstat outcome time_FEs treatment_effect treatXpost_effect ///
>                 if treat_dummy == 1, by(t) stat(mean)

Summary statistics: mean
  by categories of: t 

       t |   outcome  time_FEs  treatm~t  treatX~t
---------+----------------------------------------
       1 |  .5516668 -.2601991         1         2
       2 |  .3604333 -.4511884         1         2
       3 |  -.119968 -.9319424         1         2
       4 |  2.132736 -.6791729         1         2
       5 |  2.172479  -.639457         1         2
       6 |  1.146147 -1.665354         1         2
---------+----------------------------------------
   Total |  1.040582 -.7712189         1         2
--------------------------------------------------

.                                         
. *** Analysis part. First, run regression with the correct specification
. reg outcome treatXpost_dummy treat_dummy i.t

      Source |       SS           df       MS      Number of obs   =       600
-------------+----------------------------------   F(7, 592)       =    126.42
       Model |  962.756092         7  137.536585   Prob > F        =    0.0000
    Residual |  644.060187       592  1.08793951   R-squared       =    0.5992
-------------+----------------------------------   Adj R-squared   =    0.5944
       Total |  1606.81628       599  2.68249796   Root MSE        =     1.043

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000101   .1703283    11.74   0.000      1.66558    2.334622
     treat_dummy |   1.121747   .1204403     9.31   0.000     .8852044    1.358289
                 |
               t |
              2  |  -.1911635   .1475086    -1.30   0.195    -.4808674    .0985403
              3  |  -.6718909   .1475086    -4.55   0.000    -.9615947    -.382187
              4  |  -.4191039   .1703283    -2.46   0.014    -.7536251   -.0845827
              5  |  -.3794252   .1703283    -2.23   0.026    -.7139464    -.044904
              6  |  -1.405598   .1703283    -8.25   0.000    -1.740119   -1.071076
                 |
           _cons |  -.5700178   .1204403    -4.73   0.000      -.80656   -.3334756
----------------------------------------------------------------------------------

. 
. **  Note also how the time FEs aren't correctly estimated. Each dummy is
. *               off by the amount of the intercept. _cons in turn is equal to the
. *               omitted dummy for period t = 1. The omission is due to collinearity
. *               and the intercept is taken out of each non-omitted dummy.
. tabstat time_FEs, by(t)

Summary for variables: time_FEs
     by categories of: t 

       t |      mean
---------+----------
       1 | -.2601991
       2 | -.4511884
       3 | -.9319424
       4 | -.6791729
       5 |  -.639457
       6 | -1.665354
---------+----------
   Total | -.7712189
--------------------

. 
. *** Then, compare std. err. of treatXpost_dummy if we don't include time
. *               fixed effects but instead a post dummy
. reg outcome treatXpost_dummy treat_dummy post_dummy

      Source |       SS           df       MS      Number of obs   =       600
-------------+----------------------------------   F(3, 596)       =    235.28
       Model |  871.194294         3  290.398098   Prob > F        =    0.0000
    Residual |  735.621984       596  1.23426507   R-squared       =    0.5422
-------------+----------------------------------   Adj R-squared   =    0.5399
       Total |  1606.81628       599  2.68249796   Root MSE        =     1.111

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000101   .1814214    11.02   0.000     1.643798    2.356404
     treat_dummy |   1.121747   .1282843     8.74   0.000     .8698023    1.373691
      post_dummy |  -.4470241   .1282843    -3.48   0.001    -.6989684   -.1950798
           _cons |  -.8577026   .0907107    -9.46   0.000    -1.035854   -.6795511
----------------------------------------------------------------------------------

. 
. 
. *** Case of no time_FEs but a post effect
. gen post_effect = -0.5*post_dummy 

. replace outcome = outcome - time_FEs + post_effect
(600 real changes made)

. reg outcome treatXpost_dummy treat_dummy post_dummy

      Source |       SS           df       MS      Number of obs   =       600
-------------+----------------------------------   F(3, 596)       =    266.14
       Model |  862.805201         3  287.601734   Prob > F        =    0.0000
    Residual |  644.060191       596   1.0806379   R-squared       =    0.5726
-------------+----------------------------------   Adj R-squared   =    0.5704
       Total |  1506.86539       599  2.51563504   Root MSE        =    1.0395

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000101   .1697557    11.78   0.000     1.666709    2.333493
     treat_dummy |   1.121747   .1200354     9.35   0.000     .8860027     1.35749
      post_dummy |  -.5001396   .1200354    -4.17   0.000    -.7358834   -.2643957
           _cons |  -.3099259   .0848779    -3.65   0.000     -.476622   -.1432298
----------------------------------------------------------------------------------

. *   Then the std. err. of treatXpost_dummy is small as in the correctly
. *               specified case
. 
. *** Compare with case of including group FEs or not (test small sd_group_FEs
. *       to see the difference in std. err. of treatXpost_dummy)
. reg  outcome treatXpost_dummy treat_dummy post_dummy

      Source |       SS           df       MS      Number of obs   =       600
-------------+----------------------------------   F(3, 596)       =    266.14
       Model |  862.805201         3  287.601734   Prob > F        =    0.0000
    Residual |  644.060191       596   1.0806379   R-squared       =    0.5726
-------------+----------------------------------   Adj R-squared   =    0.5704
       Total |  1506.86539       599  2.51563504   Root MSE        =    1.0395

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000101   .1697557    11.78   0.000     1.666709    2.333493
     treat_dummy |   1.121747   .1200354     9.35   0.000     .8860027     1.35749
      post_dummy |  -.5001396   .1200354    -4.17   0.000    -.7358834   -.2643957
           _cons |  -.3099259   .0848779    -3.65   0.000     -.476622   -.1432298
----------------------------------------------------------------------------------

. areg outcome treatXpost_dummy             post_dummy, absorb(group_ID)

Linear regression, absorbing indicators         Number of obs     =        600
Absorbed variable: group_ID                     No. of categories =        100
                                                F(   2,    498)   =   9.48e+07
                                                Prob > F          =     0.0000
                                                R-squared         =     1.0000
                                                Adj R-squared     =     1.0000
                                                Root MSE          =     0.0010

----------------------------------------------------------------------------------
         outcome |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-----------------+----------------------------------------------------------------
treatXpost_dummy |   2.000101   .0001624  1.2e+04   0.000     1.999782     2.00042
      post_dummy |  -.5001396   .0001148 -4356.20   0.000    -.5003652    -.499914
           _cons |   .2509474   .0000574  4371.49   0.000     .2508346    .2510602
----------------------------------------------------------------------------------
F test of absorbed indicators: F(99, 498) =  7.5e+06          Prob > F = 0.000

. log close
      name:  <unnamed>
       log:  C:\Users\Jesper\Research\STATA-example-code\what_adding_FEs_does.log
  log type:  text
 closed on:  11 Nov 2022, 15:33:02
------------------------------------------------------------------------------------------------------
